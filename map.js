function mapView(t){this.root=t,zoom=parseInt(this.root.data("zoom")),zoom=this.root.data("zoom")?this.root.data("zoom"):6,this.map=L.map(this.root.find(".ncf-mapcontainer").get(0),{maxBoundsViscosity:.8}).setView({lon:0,lat:0},zoom).setMaxBounds([[-90,-180],[90,180]]),this.markerList=[],this.selected=null,L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'}).addTo(this.map),L.control.scale({imperial:!0,metric:!0}).addTo(this.map),first=!0,this.root.find(".ncf-map-item").each(function(t,i){const e=$(i).find(".identifyer"),s=L.icon({iconUrl:"data:image/svg+xml;base64,"+btoa(svg.replace("COLOR",e.data("color")||"#ff0000")),iconSize:[30,30],iconAnchor:[15,29],tooltipAnchor:[12,-17]}),o=$(i),a=L.marker([e.data("lat"),1*e.data("lon")],{icon:s});a.setOpacity(.8),a.bindTooltip(e.data("popup")),a.addTo(this.map),this.markerList[e.attr("id")]=a;const n=function(){this.hoverStart(o,e)}.bind(this),r=function(){this.hoverEnd(o,e)}.bind(this),c=function(){this.clickItem(o,e)}.bind(this);a.on("mouseover",n),a.on("mouseout",r),a.on("click",c),o.mouseenter(n),o.mouseleave(r),o.on("click",c),first&&(first=!1,this.map.setView(a.getLatLng()))}.bind(this));var i=new L.featureGroup(Object.values(this.markerList));this.map.fitBounds(i.getBounds()),this.map.setMinZoom(1)}svg='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M18.1568 16.8823L16.9698 18.0562C16.0949 18.9149 14.9598 20.0188 13.5639 21.3684C12.6917 22.2118 11.3079 22.2117 10.4358 21.3682L6.94466 17.9723C6.5059 17.5415 6.13863 17.1782 5.84279 16.8823C2.44238 13.4819 2.44238 7.96878 5.84279 4.56837C9.2432 1.16796 14.7564 1.16796 18.1568 4.56837C21.5572 7.96878 21.5572 13.4819 18.1568 16.8823ZM14.5 11.0001C14.5 9.61924 13.3806 8.49986 11.9998 8.49986C10.619 8.49986 9.49958 9.61924 9.49958 11.0001C9.49958 12.3809 10.619 13.5003 11.9998 13.5003C13.3806 13.5003 14.5 12.3809 14.5 11.0001Z" fill="COLOR"/>\n</svg>\n',mapView.prototype={constructor:mapView,hoverStart:function(t,i){this.markerList[i.attr("id")].openTooltip(),$(t).addClass("hover"),i.attr("id")!=this.selected&&this.markerList[i.attr("id")].setOpacity(1)},hoverEnd:function(t,i){this.markerList[i.attr("id")].closeTooltip(),$(t).removeClass("hover"),i.attr("id")!=this.selected&&this.markerList[i.attr("id")].setOpacity(.8)},clickItem:function(t,i){null!=this.selected&&(this.markerList[this.selected].setOpacity(.8),this.root.find(".ncf-map-item").removeClass("selected")),this.selected=i.attr("id"),this.markerList[this.selected].setOpacity(1),t.addClass("selected"),this.map.setView(this.markerList[this.selected].getLatLng())},update:function(){for(data in templist=[],this.markerList)templist[data]=this.markerList[data];for(item in this.root.find(".ncf-map-item").each(function(t,i){const e=$(i).find(".identifyer"),s=$(i);s.mouseenter(function(){this.hoverStart(s,e)}.bind(this)),s.mouseleave(function(){this.hoverEnd(s,e)}.bind(this)),s.click(function(){this.clickItem(s,e)}.bind(this)),templist[e.attr("id")].addTo(this.map),delete templist[e.attr("id")]}.bind(this)),templist)templist[item].remove()}},$(document).ready(()=>{$(".ncf-map").not(".ncf-filterlist").each((t,i)=>{new mapView($(i))}),$(".ncf-map.ncf-filterlist").each((t,i)=>{fl=new FilterList($(i)),map=new mapView($(i)),fl.onUpdate=function(){map.update()}})});
